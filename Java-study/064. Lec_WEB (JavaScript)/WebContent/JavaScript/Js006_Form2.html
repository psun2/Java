<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form 검증</title>
    <style>
      .important {
        color: red;
      }
    </style>
  </head>
  <!-- 
	form validation (폼 검증)
	form 데이터를 서버에 제출(submit) 하기 전에
	클라이언트에서 1차적으로 값의 유효성을 체크해주는게 좋다.
	이때 JavaScript 를 사용하여 검증합니다.
	
	ex) 
		- '필수 항목'들은 입력이 되었는지?
		- 숫자만 입력하는 경우 숫자로만 입력되었는지?
		- n글자 이상이 입력되었는지?
		- checkbox 의 경우 n개 이상이 체크 되었는지?
		- 특정포맷 (이메일, url 등..) 으로 입력되었는지?
	
	<form> 의 onsubmit 이벤트 처리 코드
		: true 를 return 하면 정상적으로 submit 됨
		: false 를 return 하면 submit 안됨 
	
	
	focus() 함수 : 해당 form element 에 입력상태(focus) 지정 → onfocus 이벤트 발동 
	blur() 함수 : 해당 form element 에 입력상태 해제 → onblur 이벤트 발동	
	submit() 함수 : 해당 form 을 submit 함
	required attribute 사용 : 
-->

  <!--
	** alert(), confirm(), prompt() 함수
	https://www.w3schools.com/jsref/met_win_alert.asp
	https://www.w3schools.com/jsref/met_win_confirm.asp
	https://www.w3schools.com/jsref/met_win_prompt.asp
	
	alert() 리턴값 없슴
	confirm()  true/false 리턴, submit 하기전에 물어보기 위해 사용 가능
	prompt() 입력한 string 리턴
 -->

  <body>
    <h3>form validation</h3>
    <hr />
    <h4>form1 (조건이 없는 form)</h4>
    <form
      name="form1"
      action="https://www.w3schools.com/action_page.php"
      method="get"
    >
      First name:
      <input type="text" name="firstname" /> <span class="important">*</span>
      <!-- 기본값 value 가 없다. -->
      <br /><br />
      Last name:
      <input type="text" name="lastname" />
      <br /><br />
      <input type="submit" value="제출" />
    </form>
    <hr />
    <!-- ----------------------------------------------------------------- -->
    <!-- 
	form 에 onsubmit 사용
	onsubmit 에 JS 코드를 수행하고 return 받은 값이 true 이면 submit 
 -->
    <script>
      // TODO:
      const checkSubmit2 = () => {
        const form = document.forms.form2;
        if (form.firstname.value.trim() === '') {
          alert('Fist Name 은 필수입니다');
          form.firstname.focus(); // return false 하기 전에 커서 입력 위치.
          return false; // onsubmit 이 false 를 리턴하면 submit 을 진행하지 않는다.
        }
        return true; // onsubmit 에 true 를 리턴하면 submit 진행함.
      };
    </script>

    <h4>form2 - 필수 항목 (onsubmit() 함수 이용 return 값 : true/false)</h4>
    <form
      name="form2"
      action="https://www.w3schools.com/action_page.php"
      method="get"
      onsubmit="return checkSubmit2();"
    >
      <!-- 반드시 onsubmit 에 return 해야 한다 -->
      First name:
      <input type="text" name="firstname" /> <span class="important">*</span>
      <!-- 기본값 value 가 없다. -->
      <br /><br />
      Last name:
      <input type="text" name="lastname" />
      <br /><br />
      <input type="submit" value="제출" />
    </form>

    <hr />
    <!-- ----------------------------------------------------------------- -->
    <script>
      // TODO:
      const checkSubmit3 = () => {
        const form = document.forms.form3;
        const age = Number(form.age.value.trim());
        console.log(isNaN(Number(form.age.value.trim())));
        // isNaN 함수() : nmber 아니면 true, number 타입이면 false 반환
        // if (isNaN(age) || age < 1 || age > 130) {
        if (
          isNaN(Number(form.age.value.trim())) ||
          form.age.value < 1 ||
          form.age.value > 130
        ) {
          alert(age + ' 는 유효한 값이 아닙니다.\n1~130사이 숫자 입력');
          form.age.focus();
          return false;
        }
        return true;
      };
    </script>

    <h4>form3 - 숫자검증 (onsubmit() 함수 이용 return 값 : true/false)</h4>
    <form
      name="form3"
      action="https://www.w3schools.com/action_page.php"
      method="get"
      onsubmit="return checkSubmit3();"
    >
      <!-- TODO : onsubmit -->
      나이 (1~130): <input type="text" name="age" /> <br /><br />
      <input type="submit" value="제출" />
    </form>

    <hr />
    <!-- ----------------------------------------------------------------- -->
    <!-- 브라우저가 자동적으로 필수 요소 체크하여 submit 여부 조정 -->
    <h4>form4 - required (required Attribute)</h4>
    <form
      name="form4"
      action="https://www.w3schools.com/action_page.php"
      method="get"
    >
      First name:
      <input type="text" name="firstname" required />
      <span class="important">*</span> <br /><br />
      Last name:
      <input type="text" name="lastname" />
      <br /><br />
      <input type="submit" value="제출" />
    </form>

    <hr />
    <!-- ----------------------------------------------------------------- -->
    <!-- 일반 JS 코드에서도 특정 form을 submit 시킬수 있다. -->
    <script>
      // TODO:
      const checkSubmit5 = () => {
        const form = document.forms.form5;
        if (form.firstname.value.trim() === '') {
          alert('First Name 은 필수 입니다.');
          form.firstname.focus();
          return;
        }
        // confirm() 한수 사용 가능. 확인/취소 선택에 따라 true/false 리턴
        if (confirm('제출하시겠습니까?')) form.submit(); // 특정 form 을 submit
      };
    </script>

    <h4>form5 - submit() (submit() 함수를 이용한 조건부 submit)</h4>
    <form
      name="form5"
      action="https://www.w3schools.com/action_page.php"
      method="get"
    >
      First name:
      <input type="text" name="firstname" />
      <span class="important">*</span> <br /><br />
      Last name:
      <input type="text" name="lastname" />
      <br /><br />
    </form>
    <!--  TODO -->
    <button onclick="checkSubmit5();">제출</button>
    <!-- form 바깥에 있다! -->

    <hr />
    <!-- ----------------------------------------------------------------- -->
    <!-- 복잡한 서식 (url, email 등은) 정규표현식(regular expression) 사용하여 체크 -->
    <script>
      // url 패턴에 대한 정규표현식
      var urlPat = /^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i;

      // email 패턴에 대한 정규표현식
      var emailPat = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+/;

      // TODO:
      const checkSubmit6 = () => {
        const form = document.forms.form6;

        document.getElementById('urlwarn').innerHTML = '';
        document.getElementById('emailwarn').innerHTML = '';

        const dangerModul = (element, id) => {
          document.getElementById(
            id,
          ).innerHTML = `${element.value} (은/는) 유효한 값이 아닙니다.`;
          element.value = '';
          element.focus();
        };

        // url 패턴 불일치 시
        const url = form.url;
        if (!urlPat.test(url.value.trim())) {
          dangerModul(url, 'urlwarn');
          return false;
        }

        // 이메일 패턴 불일치 시
        const email = form.email;
        if (!emailPat.test(email.value.trim())) {
          dangerModul(email, 'emailwarn');
          return false;
        }

        return true;
      };
    </script>

    <h4>
      form6 - regexp ( 정규식 patternMatchs( ) => java === test( ) => js )
    </h4>
    <form
      name="form6"
      action="https://www.w3schools.com/action_page.php"
      method="get"
      onsubmit="return checkSubmit6();"
    >
      <!--  TOOD : onsubmit -->

      url:
      <input type="text" name="url" /><span
        id="urlwarn"
        class="important"
      ></span>
      <br /><br />
      email:
      <input type="text" name="email" /><span
        id="emailwarn"
        class="important"
      ></span>
      <br /><br />

      <input type="submit" value="제출" />
    </form>

    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  </body>
</html>
